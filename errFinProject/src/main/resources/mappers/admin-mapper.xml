<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="Admin">
	<resultMap type="Member" id="adMember">
		<id property="mid" column="MID"/>
		<result property="mEmail" column="MEMAIL"/>
		<result property="mName" column="MNAME"/>
		<result property="mPhone" column="MPHONE"/>
		<result property="mNational" column="MNATIONAL"/>
		<result property="mDate" column="MDATE"/>
		<result property="mType" column="MTYPE"/>
	</resultMap>
	
	<resultMap type="AdmBandList" id="adBand">
		<id property="bid" column="BID"/>
		<result property="bname" column="BNAME"/>
		<result property="cname" column="CNAME"/>
		<result property="bopen_status" column="BOPEN_STATUS"/>
	</resultMap>
	
	<resultMap type="Member" id="searchMember">
		<id property="mid" column="MID"/>
		<result property="mEmail" column="MEMAIL"/>
		<result property="mPhone" column="MPHONE"/>
		<result property="mNational" column="MNATIONAL"/>
		<result property="mDate" column="MDATE"/>
		<result property="mType" column="MTYPE"/>
	</resultMap>
	
	<resultMap type="AdmBandList" id="searchBand">
		<id property="bid" column="BID"/>
		<result property="bname" column="BNAME"/>
		<result property="cname" column="CNAME"/>
		<result property="bopen_status" column="BOPEN_STATUS"/>
		<result property="mname" column="MNAME"/>
	</resultMap>
	
	<select id="selectAllMember" resultMap="adMember" parameterType="java.lang.String">
		SELECT MID, MEMAIL, MNAME, MPHONE, MNATIONAL, MDATE, MTYPE
		FROM MEMBER
		WHERE MID != 0
		ORDER BY #{ alignment } ASC
	</select>
	
	<select id="selectAllBand" resultMap="adBand" parameterType="java.util.ArrayList">
		select b.bid, b.bname, c.cname, DECODE(b.bopen_status, 'PRV', '비공개 밴드', 'PTD', '밴드명 공개', 'PUB', '공개 밴드') bopen_status
		from band b
		join category c on(c.cid = b.cid)
	</select>
	
	<select id="searchMember" resultMap="searchMember" parameterType="java.lang.String">
		select mid, memail, mname, mphone, mnational, mdate, DECODE(mtype, 'LOCAL', '로컬', 'FB', '페이스북', 'NAVER', '네이버', 'GOOGLE', '구글') mType
		from member
		where mname like '%' || #{keyword} || '%'
	</select>
	
	<select id="searchBandByName" resultMap="searchBand" parameterType="java.lang.String">
		select b.bid, b.bname, c.cname, DECODE(b.bopen_status, 'PRV', '비공개 밴드', 'PTD', '밴드명 공개', 'PUB', '공개 밴드') bopen_status, tb.mname
		from band b
		join category c on(c.cid = b.cid)
		join (select mb.bid, mb.mid, mb.mlevel, m.mname
		      from member_band mb
		      join member m on(mb.mid = m.mid)
		      where mlevel = 1) tb on(tb.bid = b.bid)
		where b.bname like '%' || #{keyword} || '%'
	</select>
	
	<select id="searchBandByMaster" resultMap="searchBand" parameterType="java.lang.String">
		select b.bid, b.bname, c.cname, DECODE(b.bopen_status, 'PRV', '비공개 밴드', 'PTD', '밴드명 공개', 'PUB', '공개 밴드') bopen_status, tb.mname
		from band b
		join category c on(c.cid = b.cid)
		join (select mb.bid, mb.mid, mb.mlevel, m.mname
		      from member_band mb
		      join member m on(mb.mid = m.mid)
		      where mlevel = 1) tb on(tb.bid = b.bid)
		where tb.mname like '%' || #{keyword} || '%'
	</select>
</mapper>