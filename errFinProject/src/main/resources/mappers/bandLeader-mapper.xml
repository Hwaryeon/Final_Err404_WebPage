<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Band">
	<resultMap type="Band" id="BandResultSet">
		<id property="bid" column="BID" />
		<result property="bname" column="BNAME" />
		<result property="bopen_status" column="BOPEN_STATUS" />
		<result property="bintro" column="BINTRO" />
		<result property="cid" column="CID" />
		<result property="binvite_code" column="BINVITE_CODE" />
		<result property="bstatus" column="BSTATUS" />
	</resultMap>
	
	<resultMap type="Member_Band" id="Member_BandResultSet">
		<id property="mbid" column="MBID" />
		<result property="bid" column="BID" />
		<result property="mid" column="MID" />
		<result property="idate" column="IDATE" />
		<result property="istatus" column="ISTATUS" />
		<result property="mlevel" column="MLEVEL" />
		<result property="mname" column="MNAME" />
	</resultMap>
	
	<resultMap type="Profile" id="ProfileResultSet">
		<id property="pid" column="PID" />
		<result property="originName" column="ORIGIN_NAME" />
		<result property="editName" column="EDIT_NAME" />
		<result property="fileSrc" column="FILE_SRC" />
		<result property="fdate" column="FDATE" />
		<result property="ftype" column="FTYPE" />
		<result property="mid" column="MID" />
		<result property="bid" column="BID" />
	</resultMap>
	
	
	<!-- 밴드 오픈설정 변경 메소드 -->
	<update id = "updateBandOpenStatus" parameterType = "Band">
		UPDATE BAND SET BOPEN_STATUS = #{bopen_status}
		WHERE BID = #{bid}
	</update>
	
	<!-- 밴드가입한 회원 목록 메소드 -->
	<select id = "selectMember_BandList" parameterType = "Member_Band" resultMap = "Member_BandResultSet">
		SELECT MB.MBID, MB.BID, MB.IDATE, MB.ISTATUS, MB.MLEVEL, M.MNAME 
		FROM MEMBER_BAND MB
		JOIN MEMBER M ON (M.MID = MB.MID)
		WHERE BID = #{bid} AND ISTATUS = 'Y'
		
	</select>
	
	<!-- 공동리더 위임 메소드 -->
	<update id="insertBandMultiLeader" parameterType="int">
		UPDATE MEMBER_BAND SET MLEVEL = '2' WHERE MBID = #{mbid}
	</update>
	
	<!-- 공동리더 삭제 메소드 -->
	<update id="deleteBandMultiLeader" parameterType="int">
		UPDATE MEMBER_BAND SET MLEVEL = '3' WHERE MBID = #{mbid}
	</update>
	
	<!-- 밴드가입한 회원 검색 목록 메소드 -->
	<select id = "searchMember_BandList" parameterType = "Member_Band" resultMap = "Member_BandResultSet">
		SELECT MB.MBID, MB.BID, MB.IDATE, MB.ISTATUS, MB.MLEVEL, M.MNAME 
		FROM MEMBER_BAND MB
		JOIN MEMBER M ON (M.MID = MB.MID)
		WHERE BID = #{bid} AND ISTATUS = 'Y'
		<if test="mname != null">
			AND M.MNAME LIKE '%'|| #{mname} ||'%'
		</if>
	</select>
	
	<!-- 리더 위임 메소드 -->
	<update id="changeBandLeader" parameterType="int">
		UPDATE MEMBER_BAND SET MLEVEL = '1' WHERE MBID = #{mbid}
	</update>
	
	<!-- 리더 위임 메소드 -->
	<update id="changeBandLeader_2" parameterType="int">
		UPDATE MEMBER_BAND SET MLEVEL = '3' WHERE MLEVEL = '1' AND BID = #{bid}
	</update>
	
	<!-- 밴드 탈퇴 메소드 -->
	<update id="secessionBand" parameterType="int">
		UPDATE MEMBER_BAND SET ISTATUS = 'N' WHERE BID = #{bid} AND MID = #{mid}
	</update>
	
	<!-- 밴드 삭제 메소드 -->
	<update id="deleteBand" parameterType="int">
		UPDATE BAND SET BSTATUS = 'N' WHERE BID = #{bid}
	</update>
	
	<!-- 밴드 소개 변경 메소드 -->
	<update id="updateBandIntro" parameterType="Band">
		UPDATE BAND SET BINTRO = #{bintro} WHERE BID = #{bid}
	</update>
	
	<!-- 밴드 프로필 변경 메소드 -->
	<insert id="insertBandModify" parameterType="Profile">
		INSERT INTO PROFILE
		VALUES(SEQ_PID.NEXTVAL, #{originName}, #{editName}, #{fileSrc},  SYSDATE, '2', NULL, #{bid})

	</insert>
	
	<!-- 밴드명 변경 메소드 -->
	<update id="updateBandName" parameterType="Band">
		UPDATE BAND SET BNAME = #{bname} WHERE BID = #{bid}
	</update>
	
	<!-- 밴드명을 가져오는 메소드 -->
	<select id = "selectBandName" parameterType = "int" resultType = "java.lang.String">
		SELECT BNAME
		FROM BAND
		WHERE BID = #{bid}
	</select>
	
	<!-- 밴드 프로필 정보를 가져오는 메소드 -->
	<select id = "selectProfile" parameterType = "int" resultMap = "ProfileResultSet">
		SELECT * FROM(SELECT *
		FROM PROFILE
		WHERE BID = #{bid}
        ORDER BY FDATE DESC
        ) WHERE ROWNUM = 1
	</select>
	
	<!-- 밴드 멤버 탈퇴 시키는  메소드 -->
	<update id="deleteBandMember" parameterType="int">
		UPDATE MEMBER_BAND SET ISTATUS = 'N' WHERE MBID = #{mbid}
	</update>
	
	<!-- 밴드 오픈상태 정보를 가져오는 메소드 -->
	<select id = "checkBandOpenStatus" parameterType = "int" resultType = "java.lang.String">
		SELECT BOPEN_STATUS FROM BAND WHERE BID = #{bid}
	</select>
	
	<!-- 밴드 소개 정보를 가져오는 메소드 -->
	<select id = "selectBandIntro" parameterType = "int" resultType = "java.lang.String">
		SELECT BINTRO FROM BAND WHERE BID = #{bid}
	</select>
	
</mapper>


















