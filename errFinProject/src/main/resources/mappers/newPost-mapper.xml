<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="newPost">
	<resultMap type="Category" id="CategoryResultSet">
		<id property="cid" column="CID" />
		<result property="cname" column="CNAME" />
	</resultMap>
	
	<resultMap type="Band" id="BandResultSet">
		<id property="bid" column="BID" />
		<result property="bname" column="BNAME" />
		<result property="bopen_status" column="BOPEN_STATUS" />
		<result property="bintro" column="BINTRO" />
		<result property="cid" column="CID" />
		<result property="binvite_code" column="BINVITE_CODE" />
		<result property="bstatus" column="BSTATUS" />
	</resultMap>
	
	<resultMap type="Boards" id="BoardsResultSet">
		<id property="boardid" column="BOARDID" />
		<result property="bid" column="BID" />
		<result property="mid" column="MID" />
		<result property="bcontent" column="BCONTENT" />
		<result property="bdate" column="BDATE" />
		<result property="bstatus" column="BSTATUS" />
		<result property="ref_status" column="REF_STATUS" />
		<result property="ref_bid" column="REF_BID" />
	</resultMap>
	
	<resultMap type="Member" id="memberResultSet">
		<id property="mid" column="MID" />
		<result property="mEmail" column="MEMAIL" />
		<result property="mPwd" column="MPWD" />
		<result property="mToken" column="MTOKEN" />
		<result property="mType" column="MTYPE" />
		<result property="mName" column="MNAME" />
		<result property="mPhone" column="MPHONE" />
		<result property="mDate" column="MDATE" />
		<result property="mStatus" column="MSTATUS" />
		<result property="mNational" column="MNATIONAL" />
	</resultMap>

	<!-- 카테고리 목록 메소드 -->
	<select id = "selectCategoryList" resultMap = "CategoryResultSet">
		SELECT * FROM CATEGORY
	</select>
	
	<!-- 가입 밴드 목록 메소드 -->
	<select id = "selectBandList" parameterType = "java.lang.String" resultMap = "BandResultSet">
		SELECT B.BID, B.BNAME
		FROM MEMBER M
		JOIN MEMBER_BAND MB ON(MB.MID = M.MID)
		JOIN BAND B ON(B.BID = MB.BID)
		WHERE M.MEMAIL = #{memail}
		AND B.BSTATUS = 'Y'
		AND MB.ISTATUS = 'Y'
	</select>
	
	<!-- 밴드 프로필 메소드 -->
	<select id = "selectBandProfile" parameterType = "int" resultMap = "BandResultSet">
		SELECT B.BID, B.BNAME
		FROM MEMBER M
		JOIN MEMBER_BAND MB ON(MB.MID = M.MID)
		JOIN BAND B ON(B.BID = MB.BID)
		WHERE M.MEMAIL = #{memail}
		AND B.BSTATUS = 'Y'
		AND MB.ISTATUS = 'Y'
	</select>
	
	<!-- 전체 밴드 목록 메소드 -->
	<select id = "selectAllBandList" resultMap = "BandResultSet">
		SELECT * FROM BAND
		WHERE BSTATUS = 'Y' AND BOPEN_STATUS != 'PRV'
	</select>
	
	<!-- 전체 밴드 목록 메소드 -->
	<select id = "selectBandMemberCount" parameterType = "int" resultType = "int">
		SELECT COUNT(*) AS MCOUNT
		FROM MEMBER_BAND
		WHERE BID = #{bid}
		AND ISTATUS = 'Y'
	</select>
	
	<!-- 새글 피드 리스트를 가져오는 메소드 -->
	<select id = "selectNewPostList" parameterType = "int" resultMap = "BoardsResultSet">
		SELECT *
		FROM BOARDS
		WHERE MID= #{mid}
		AND BSTATUS = 'Y'
		AND REF_STATUS = 'CONTENT'
		ORDER BY BDATE DESC
	</select>
	
	<!-- 멤버 정보를 가져오는 메소드 -->
	<select id = "selectMember" parameterType = "int" resultMap = "memberResultSet">
		SELECT *
		FROM MEMBER
		WHERE MID = #{mid}
	</select>
	
	<!-- 해당 밴드에 새글 갯수를 가져오는 메소드 -->
	<!-- <select id = "selectBandMemberCount" parameterType = "int" resultType = "int">
		SELECT count(*)
		FROM BOARDS
		WHERE BID = #{bid};
	</select> -->
	
	
</mapper>


















